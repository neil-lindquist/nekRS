// Need to keep in sync with poly_imp.h

#define GLL_LAG_FIX_MAX 24

static const dfloat gllz_02[ 2] = {
  -1.0,
   1.0
};
static const dfloat gllz_03[ 3] = {
  -1.0,
   0.0,
   1.0
};
static const dfloat gllz_04[ 4] = {
  -1.0,
  -0.44721359549995793928183473374625524708812367192231,
   0.44721359549995793928183473374625524708812367192231,
   1.0
};
static const dfloat gllz_05[ 5] = {
  -1.0,
  -0.65465367070797714379829245624685835556920808239542,
   0.0,
   0.65465367070797714379829245624685835556920808239542,
   1.0
};
static const dfloat gllz_06[ 6] = {
  -1.0,
  -0.7650553239294646928510029739593381503657356885361,
  -0.28523151648064509631415099404087907191900347272643,
   0.28523151648064509631415099404087907191900347272643,
   0.7650553239294646928510029739593381503657356885361,
   1.0
};
static const dfloat gllz_07[ 7] = {
  -1.0,
  -0.830223896278566929872032213967465139587170364872,
  -0.46884879347071421380377188190876632940559747167184,
   0.0,
   0.46884879347071421380377188190876632940559747167184,
   0.830223896278566929872032213967465139587170364872,
   1.0
};
static const dfloat gllz_08[ 8] = {
  -1.0,
  -0.87174014850960661533744576122066343810378066967698,
  -0.59170018143314230214451073139795318994570098951733,
  -0.20929921790247886876865726034535125529554540508668,
   0.20929921790247886876865726034535125529554540508668,
   0.59170018143314230214451073139795318994570098951733,
   0.87174014850960661533744576122066343810378066967698,
   1.0
};
static const dfloat gllz_09[ 9] = {
  -1.0,
  -0.8997579954114601573123452444183379580514802955661,
  -0.67718627951073775344588542709134245071102964761391,
  -0.36311746382617815871075206870865921302064227760088,
   0.0,
   0.36311746382617815871075206870865921302064227760088,
   0.67718627951073775344588542709134245071102964761391,
   0.8997579954114601573123452444183379580514802955661,
   1.0
};
static const dfloat gllz_10[10] = {
  -1.0,
  -0.91953390816645881382893266082233813415354307544628,
  -0.73877386510550507500310617485983072501618510137693,
  -0.47792494981044449566117509273125799788677289333057,
  -0.16527895766638702462621976595817353323115034354948,
   0.16527895766638702462621976595817353323115034354948,
   0.47792494981044449566117509273125799788677289333057,
   0.73877386510550507500310617485983072501618510137693,
   0.91953390816645881382893266082233813415354307544628,
   1.0
};
static const dfloat gllz_11[11] = {
  -1.0,
  -0.93400143040805913433227413609938363453991733010996,
  -0.78448347366314441862241781610845810350719745509406,
  -0.56523532699620500647096396947775166428305214556202,
  -0.2957581355869393914319115155590575089410064343486,
   0.0,
   0.2957581355869393914319115155590575089410064343486,
   0.56523532699620500647096396947775166428305214556202,
   0.78448347366314441862241781610845810350719745509406,
   0.93400143040805913433227413609938363453991733010996,
   1.0
};
static const dfloat gllz_12[12] = {
  -1.0,
  -0.94489927222288222340758013830321871361125655195003,
  -0.81927932164400667834864158171690266069046665790364,
  -0.6328761530318606776624048544436558582438437454015,
  -0.39953094096534893226434979156696690052774803279531,
  -0.13655293285492755486406185573969389689841411128206,
   0.13655293285492755486406185573969389689841411128206,
   0.39953094096534893226434979156696690052774803279531,
   0.6328761530318606776624048544436558582438437454015,
   0.81927932164400667834864158171690266069046665790364,
   0.94489927222288222340758013830321871361125655195003,
   1.0
};
static const dfloat gllz_13[13] = {
  -1.0,
  -0.95330984664216391189690546475544915162650788869736,
  -0.84634756465187231686592560709875335957803665971441,
  -0.68618846908175742607275903956635555292917619812438,
  -0.48290982109133620174693723363693362077219326211859,
  -0.24928693010623999256867370037422698148881131249298,
   0.0,
   0.24928693010623999256867370037422698148881131249298,
   0.48290982109133620174693723363693362077219326211859,
   0.68618846908175742607275903956635555292917619812438,
   0.84634756465187231686592560709875335957803665971441,
   0.95330984664216391189690546475544915162650788869736,
   1.0
};
static const dfloat gllz_14[14] = {
  -1.0,
  -0.95993504526726090135510016201542438906639151857265,
  -0.86780105383034725100022020290826421324987235309444,
  -0.72886859909132614058467240052088159565733953169432,
  -0.55063940292864705531662270585908063446213831955391,
  -0.34272401334271284504390340364167464483311353414031,
  -0.11633186888370386765877670973616016794150904425628,
   0.11633186888370386765877670973616016794150904425628,
   0.34272401334271284504390340364167464483311353414031,
   0.55063940292864705531662270585908063446213831955391,
   0.72886859909132614058467240052088159565733953169432,
   0.86780105383034725100022020290826421324987235309444,
   0.95993504526726090135510016201542438906639151857265,
   1.0
};
static const dfloat gllz_15[15] = {
  -1.0,
  -0.96524592650383857279585139206960117770765013599709,
  -0.88508204422297629882540163148222965198871408520748,
  -0.76351968995181520070411847597629161817736852031529,
  -0.60625320546984571112352993863673350717973103375992,
  -0.42063805471367248092189693873858041298433820549243,
  -0.21535395536379423822567944627291771265215790120304,
   0.0,
   0.21535395536379423822567944627291771265215790120304,
   0.42063805471367248092189693873858041298433820549243,
   0.60625320546984571112352993863673350717973103375992,
   0.76351968995181520070411847597629161817736852031529,
   0.88508204422297629882540163148222965198871408520748,
   0.96524592650383857279585139206960117770765013599709,
   1.0
};
static const dfloat gllz_16[16] = {
  -1.0,
  -0.96956804627021793295224273836745924138899074650383,
  -0.89920053309347209299462826151984947674999760904514,
  -0.7920082918618150639310882709631457058080738279802,
  -0.65238870288249308946788321964058148032155801282957,
  -0.48605942188713761178189078584687469688897730429825,
  -0.29983046890076320809835345472230064781546097690778,
  -0.10132627352194944784303300504591776253324091440019,
   0.10132627352194944784303300504591776253324091440019,
   0.29983046890076320809835345472230064781546097690778,
   0.48605942188713761178189078584687469688897730429825,
   0.65238870288249308946788321964058148032155801282957,
   0.7920082918618150639310882709631457058080738279802,
   0.89920053309347209299462826151984947674999760904514,
   0.96956804627021793295224273836745924138899074650383,
   1.0
};
static const dfloat gllz_17[17] = {
  -1.0,
  -0.97313217663141831415697950187372143058895914912251,
  -0.91087999591557359562380250639772646753087945186873,
  -0.81569625122177030710675055323752665471640239706712,
  -0.69102898062768470539491935737245329680641306219042,
  -0.54138539933010153912373340750406325167514664796483,
  -0.37217443356547704190723468073525781255981731440028,
  -0.1895119735183173883042630147531139713449924229225,
   0.0,
   0.1895119735183173883042630147531139713449924229225,
   0.37217443356547704190723468073525781255981731440028,
   0.54138539933010153912373340750406325167514664796483,
   0.69102898062768470539491935737245329680641306219042,
   0.81569625122177030710675055323752665471640239706712,
   0.91087999591557359562380250639772646753087945186873,
   0.97313217663141831415697950187372143058895914912251,
   1.0
};
static const dfloat gllz_18[18] = {
  -1.0,
  -0.97610555741219854286451892434170006676181344271919,
  -0.92064918534753387383785462543127742356235348618904,
  -0.83559353521809021371364636232793725743367075916582,
  -0.72367932928324268130621036530207067914952520415476,
  -0.58850483431866176117353589319355946900083678931622,
  -0.43441503691212397534228713674067479584975844516369,
  -0.26636265287828098416766533202559594206513618931826,
  -0.089749093484652111022645010088561734960603901041125,
   0.089749093484652111022645010088561734960603901041125,
   0.26636265287828098416766533202559594206513618931826,
   0.43441503691212397534228713674067479584975844516369,
   0.58850483431866176117353589319355946900083678931622,
   0.72367932928324268130621036530207067914952520415476,
   0.83559353521809021371364636232793725743367075916582,
   0.92064918534753387383785462543127742356235348618904,
   0.97610555741219854286451892434170006676181344271919,
   1.0
};
static const dfloat gllz_19[19] = {
  -1.0,
  -0.97861176622208009515263406311022256281427733781081,
  -0.92890152815258624371794025879654861245016818225195,
  -0.85246057779664609308595597004106262523709538083887,
  -0.7514942025526130141636374896339440404036593556658,
  -0.62890813726522049776683230622873254706861115718956,
  -0.48822928568071350277790963762492336977121559965148,
  -0.33350484782449861029850010384492701192296337547773,
  -0.16918602340928157137515415344488042375289555076585,
   0.0,
   0.16918602340928157137515415344488042375289555076585,
   0.33350484782449861029850010384492701192296337547773,
   0.48822928568071350277790963762492336977121559965148,
   0.62890813726522049776683230622873254706861115718956,
   0.7514942025526130141636374896339440404036593556658,
   0.85246057779664609308595597004106262523709538083887,
   0.92890152815258624371794025879654861245016818225195,
   0.97861176622208009515263406311022256281427733781081,
   1.0
};
static const dfloat gllz_20[20] = {
  -1.0,
  -0.98074370489391417192544643858423091522991062312625,
  -0.93593449881266543571618158493062692991557383318105,
  -0.86687797808995014130984721461628521396291128831699,
  -0.77536826095205587041431752759469134337272185947653,
  -0.66377640229031128984640332297115885247574574199149,
  -0.53499286403188626164813596182898398300685156913752,
  -0.39235318371390929938647470381582436666520332929891,
  -0.23955170592298649518240135692708807194151780992738,
  -0.080545937238821837975944518159554463022392870092908,
   0.080545937238821837975944518159554463022392870092908,
   0.23955170592298649518240135692708807194151780992738,
   0.39235318371390929938647470381582436666520332929891,
   0.53499286403188626164813596182898398300685156913752,
   0.66377640229031128984640332297115885247574574199149,
   0.77536826095205587041431752759469134337272185947653,
   0.86687797808995014130984721461628521396291128831699,
   0.93593449881266543571618158493062692991557383318105,
   0.98074370489391417192544643858423091522991062312625,
   1.0
};
static const dfloat gllz_21[21] = {
  -1.0,
  -0.98257229660454802823448127655540587685917158823641,
  -0.94197629695974553429610265066143517664965087404401,
  -0.8792947553235904644511535963049440477105815515092,
  -0.79600192607771240474431258966035863909041966054978,
  -0.69405102606222323262731639319466662875771600610585,
  -0.57583196026183068692702187033808528733577300855848,
  -0.44411578327900210119451634960735128473505748656706,
  -0.30198985650876488727535186785875223202107103406039,
  -0.15278551580218546600635832848566943551774899331328,
   0.0,
   0.15278551580218546600635832848566943551774899331328,
   0.30198985650876488727535186785875223202107103406039,
   0.44411578327900210119451634960735128473505748656706,
   0.57583196026183068692702187033808528733577300855848,
   0.69405102606222323262731639319466662875771600610585,
   0.79600192607771240474431258966035863909041966054978,
   0.8792947553235904644511535963049440477105815515092,
   0.94197629695974553429610265066143517664965087404401,
   0.98257229660454802823448127655540587685917158823641,
   1.0
};
static const dfloat gllz_22[22] = {
  -1.0,
  -0.98415243845764617655228962221207029660551353611952,
  -0.94720428399922868052421376661572950991206204534136,
  -0.89006229019090447052965782577908679019953408284715,
  -0.8139489276119211360454418480561350424386685149071,
  -0.7204872399612021581198818963984657585933454261195,
  -0.6116694382842589712262116058699265993454403046077,
  -0.48981487518990234980875123568327004167127163579515,
  -0.35752071013891953806095728024017912928330710394294,
  -0.21760658515928504178795509346539276327500669401419,
  -0.073054540010898334761088790464107356192779236333516,
   0.073054540010898334761088790464107356192779236333516,
   0.21760658515928504178795509346539276327500669401419,
   0.35752071013891953806095728024017912928330710394294,
   0.48981487518990234980875123568327004167127163579515,
   0.6116694382842589712262116058699265993454403046077,
   0.7204872399612021581198818963984657585933454261195,
   0.8139489276119211360454418480561350424386685149071,
   0.89006229019090447052965782577908679019953408284715,
   0.94720428399922868052421376661572950991206204534136,
   0.98415243845764617655228962221207029660551353611952,
   1.0
};
static const dfloat gllz_23[23] = {
  -1.0,
  -0.98552715587873257808146276673809909902061079213965,
  -0.9517579557107102041356396798514291558483519254488,
  -0.89945855804034501095016032034736715791179834813929,
  -0.82965109665128588622320061929000488459851188301333,
  -0.74369504117206068394516354306699679128721922895386,
  -0.6432636444601362084761455336027687438913118818023,
  -0.53031177113684416813011532015229981113034651492734,
  -0.40703793791447482919595048821509563955195372399417,
  -0.27584154894579306710687763267913520417319110660942,
  -0.13927620404066839859186261298276693390854445717444,
   0.0,
   0.13927620404066839859186261298276693390854445717444,
   0.27584154894579306710687763267913520417319110660942,
   0.40703793791447482919595048821509563955195372399417,
   0.53031177113684416813011532015229981113034651492734,
   0.6432636444601362084761455336027687438913118818023,
   0.74369504117206068394516354306699679128721922895386,
   0.82965109665128588622320061929000488459851188301333,
   0.89945855804034501095016032034736715791179834813929,
   0.9517579557107102041356396798514291558483519254488,
   0.98552715587873257808146276673809909902061079213965,
   1.0
};
static const dfloat gllz_24[24] = {
  -1.0,
  -0.9867305535051608835530867381544749753719197924133,
  -0.95574822092988635802697713055064483107073304295574,
  -0.90770567511350652199515299646620774920842011387828,
  -0.84346407015487204062330503742334228584107610081033,
  -0.7641704824204933077873752809522936513210604492369,
  -0.67124010526412869983566485818700675657402328894643,
  -0.56633135797929531218940954454228377043889499712648,
  -0.45131637321432261824821849156962244882308821831249,
  -0.3282476133755109120333891793596093437011778687727,
  -0.19932125339083266723657253912499073081187559142148,
  -0.066837993737228578113641808391677309796223208917628,
   0.066837993737228578113641808391677309796223208917628,
   0.19932125339083266723657253912499073081187559142148,
   0.3282476133755109120333891793596093437011778687727,
   0.45131637321432261824821849156962244882308821831249,
   0.56633135797929531218940954454228377043889499712648,
   0.67124010526412869983566485818700675657402328894643,
   0.7641704824204933077873752809522936513210604492369,
   0.84346407015487204062330503742334228584107610081033,
   0.90770567511350652199515299646620774920842011387828,
   0.95574822092988635802697713055064483107073304295574,
   0.9867305535051608835530867381544749753719197924133,
   1.0
};
// OCCA crashes is this definition on CUDA
//const dfloat *gllz_n[23] = {
//                    gllz_02, gllz_03, gllz_04,
//  gllz_05, gllz_06, gllz_07, gllz_08, gllz_09,
//  gllz_10, gllz_11, gllz_12, gllz_13, gllz_14,
//  gllz_15, gllz_16, gllz_17, gllz_18, gllz_19,
//  gllz_20, gllz_21, gllz_22, gllz_23, gllz_24
//};

void lagrange_eval(@restrict dfloat * p0,
                   @restrict const dfloat * data,
                   dlong n,
                   dlong der,
                   dfloat x,
                   dlong i){
  if(i<n){
    const dfloat *z, *w;
    w = data;
    switch(n){
      case  2: z = gllz_02; break;
      case  3: z = gllz_03; break;
      case  4: z = gllz_04; break;
      case  5: z = gllz_05; break;
      case  6: z = gllz_06; break;
      case  7: z = gllz_07; break;
      case  8: z = gllz_08; break;
      case  9: z = gllz_09; break;
      case 10: z = gllz_10; break;
      case 11: z = gllz_11; break;
      case 12: z = gllz_12; break;
      case 13: z = gllz_13; break;
      case 14: z = gllz_14; break;
      case 15: z = gllz_15; break;
      case 16: z = gllz_16; break;
      case 17: z = gllz_17; break;
      case 18: z = gllz_18; break;
      case 19: z = gllz_19; break;
      case 20: z = gllz_20; break;
      case 21: z = gllz_21; break;
      case 22: z = gllz_22; break;
      case 23: z = gllz_23; break;
      case 24: z = gllz_24; break;
      default: z = data; w = z+n;
    }
    if(der==0) {
      // for(j=0; j<n; ++j) if(i!=j) p_i *= 2*(x-z[j])
      dfloat p_i = (1 << (n-1));
      for(dlong j=0;j<n;++j){
        dfloat d_j = x-z[j];
        p_i *= j==i ? 1 : d_j;
      }
      p0[i] = w[i] * p_i;
    } else if(der==1) {
      dfloat u0=1, u1=0;
      for(dlong j=0;j<n;++j){
        if(i!=j){
          dfloat d_j = 2*(x-z[j]);
          u1 = d_j*u1+u0;
          u0 = d_j*u0;
        }
      }
      dfloat *p1 = p0+n;
      p0[i] =   w[i]*u0;
      p1[i] = 2*w[i]*u1;
    } else {
      dfloat u0=1, u1=0, u2=0;
      for(dlong j=0;j<n;++j){
        if(i!=j){
          dfloat d_j = 2*(x-z[j]);
          u2 = d_j*u2 + u1;
          u1 = d_j*u1 + u0;
          u0 = d_j*u0;
        }
      }
      dfloat *p1 = p0+n, *p2 = p0+2*n;
      p0[i]=  w[i]*u0;
      p1[i]=2*w[i]*u1;
      p2[i]=4*w[i]*u2;
    }
  }
}
